# 📊 دليل سير العمل المرئي - رموز QR التلقائية

## 🎯 النظام الكامل

```
┌─────────────────────────────────────────────────────────┐
│          نظام إدارة المخزون مع رموز QR التلقائية          │
└─────────────────────────────────────────────────────────┘
```

---

## 🔄 سير العمل الكامل

### المرحلة 1️⃣: إضافة منتج

```
    ┌─────────────────┐
    │  inventory.html │
    └────────┬────────┘
             │
             ↓
    ┌────────────────────┐
    │ انقر "إضافة منتج"  │
    └────────┬───────────┘
             │
             ↓
    ┌─────────────────────────┐
    │   Modal يفتح            │
    │   • رمز المنتج          │
    │   • اسم المنتج          │
    │   • سعر الشراء          │
    │   • سعر البيع           │
    │   • الكمية              │
    │   • الحد الأدنى         │
    └────────┬────────────────┘
             │
             ↓
    ┌─────────────────────┐
    │  انقر "حفظ"         │
    └────────┬────────────┘
             │
             ↓
    ┌──────────────────────────┐
    │  حفظ في قاعدة البيانات   │
    │  (Supabase - inventory)  │
    └────────┬─────────────────┘
             │
             ↓
    ┌───────────────────────────┐
    │  عرض في الجدول            │
    │  مع زر QR أخضر 🟢        │
    └───────────────────────────┘
```

---

### المرحلة 2️⃣: عرض وتحميل QR

```
    ┌─────────────────────┐
    │  الجدول يعرض:       │
    │  • المنتجات         │
    │  • زر QR 🟢 لكل صف │
    └────────┬────────────┘
             │
             ↓
    ┌──────────────────────┐
    │  انقر زر QR 🟢      │
    └────────┬─────────────┘
             │
             ↓
    ┌────────────────────────────┐
    │  دالة viewQRCode()         │
    │  • تستقبل بيانات المنتج    │
    │  • تفتح Modal              │
    └────────┬───────────────────┘
             │
             ↓
    ┌───────────────────────────────┐
    │  QRCode.toCanvas()            │
    │  • ينشئ QR من product_code   │
    │  • 300x300 بكسل              │
    │  • ألوان مخصصة               │
    └────────┬──────────────────────┘
             │
             ↓
    ┌────────────────────────────────┐
    │  Modal يعرض:                   │
    │  ┌──────────────────┐          │
    │  │   QR Code كبير  │          │
    │  └──────────────────┘          │
    │  المنتج: كاميرا أمنية         │
    │  الرمز: PROD001                │
    │                                │
    │  [تحميل] [طباعة] [إغلاق]      │
    └────────┬───────────────────────┘
             │
             ├──────────┬──────────────┐
             │          │              │
             ↓          ↓              ↓
    ┌─────────┐  ┌──────────┐  ┌────────┐
    │ تحميل   │  │  طباعة   │  │ إغلاق │
    └────┬────┘  └────┬─────┘  └────────┘
         │            │
         ↓            ↓
    ┌────────┐  ┌─────────────┐
    │ PNG    │  │ نافذة طباعة│
    │ ملف    │  │ مباشرة      │
    └────────┘  └─────────────┘
```

---

### المرحلة 3️⃣: طباعة ولصق

```
    ┌──────────────────┐
    │  ملف PNG محمّل   │
    └────────┬─────────┘
             │
             ↓
    ┌──────────────────────┐
    │  طباعة على ملصقات   │
    │  (Label Stickers)    │
    └────────┬─────────────┘
             │
             ↓
    ┌──────────────────────┐
    │  لصق على المنتج       │
    │  الفعلي              │
    └────────┬─────────────┘
             │
             ↓
    ┌──────────────────────┐
    │  منتج جاهز للبيع     │
    │  مع QR Code ملصوق   │
    └──────────────────────┘
```

---

### المرحلة 4️⃣: البيع عبر POS

```
    ┌─────────────────────┐
    │  sales.html         │
    └────────┬────────────┘
             │
             ↓
    ┌─────────────────────────┐
    │  انقر "نقطة بيع جديدة" │
    └────────┬────────────────┘
             │
             ↓
    ┌─────────────────────┐
    │  pos-scanner.html   │
    └────────┬────────────┘
             │
             ↓
    ┌────────────────────────┐
    │  فتح الكاميرا          │
    │  (html5-qrcode)        │
    └────────┬───────────────┘
             │
             ↓
    ┌──────────────────────────┐
    │  مسح QR من المنتج الفعلي│
    └────────┬─────────────────┘
             │
             ↓
    ┌──────────────────────────────┐
    │  قراءة product_code          │
    │  (مثال: PROD001)             │
    └────────┬─────────────────────┘
             │
             ↓
    ┌───────────────────────────────┐
    │  البحث في قاعدة البيانات     │
    │  SELECT * FROM inventory      │
    │  WHERE product_code='PROD001' │
    └────────┬──────────────────────┘
             │
             ↓
    ┌────────────────────────────┐
    │  إضافة للسلة:              │
    │  • اسم: كاميرا أمنية       │
    │  • سعر: 45.500 ر.ع        │
    │  • كمية: 1 (قابل للتعديل) │
    └────────┬───────────────────┘
             │
             ↓
    ┌─────────────────────────┐
    │  انقر "متابعة للدفع"    │
    └────────┬────────────────┘
             │
             ↓
    ┌─────────────────────┐
    │  sale-review.html   │
    └────────┬────────────┘
             │
             ↓
    ┌──────────────────────────┐
    │  مراجعة السلة            │
    │  • المنتجات              │
    │  • الكميات               │
    │  • المجموع               │
    └────────┬─────────────────┘
             │
             ↓
    ┌─────────────────────┐
    │  انقر "تأكيد البيع" │
    └────────┬────────────┘
             │
             ↓
    ┌──────────────────────────────┐
    │  النظام ينفذ تلقائياً:       │
    │  1. حفظ في sales ✅          │
    │  2. حفظ في sale_items ✅     │
    │  3. إنقاص المخزون ✅          │
    │  4. حفظ في transactions ✅   │
    │  5. إنشاء فاتورة ✅ (Trigger)│
    │  6. حفظ invoice_items ✅     │
    └──────────────────────────────┘
```

---

## 🗂️ بنية الملفات

```
oufq/
│
├── inventory.html ⭐ (الملف الرئيسي)
│   ├── عرض جدول المنتجات
│   ├── زر QR 🟢 لكل منتج
│   ├── Modal لعرض QR
│   ├── تحميل PNG
│   └── طباعة مباشرة
│
├── pos-scanner.html
│   ├── مسح QR Code
│   ├── إضافة للسلة
│   └── معالجة البيع
│
├── sales.html
│   └── قائمة المبيعات
│
├── invoices.html
│   └── عرض الفواتير
│
├── accounting.html
│   └── لوحة التحكم
│
└── الدلائل:
    ├── QR_USAGE_GUIDE.md ⭐ (دليل الاستخدام)
    ├── AUTO_QR_FEATURE.md (التحديثات)
    ├── QR_CODES_GUIDE.md (دليل شامل)
    └── QUICK_START.md (بداية سريعة)
```

---

## 🔧 المكونات التقنية

### 1. Frontend (HTML/CSS/JS)

```
┌────────────────────────┐
│  inventory.html        │
├────────────────────────┤
│  • Bootstrap UI        │
│  • Font Awesome Icons  │
│  • Cairo Font          │
│  • RTL Support         │
└────────────────────────┘
```

### 2. Libraries

```
┌─────────────────────────────┐
│  CDN Libraries              │
├─────────────────────────────┤
│  • Supabase JS v2           │
│  • QRCode.js v1.5.3 ⭐      │
│  • html5-qrcode (scanner)   │
└─────────────────────────────┘
```

### 3. Database (Supabase)

```
┌────────────────────────────────┐
│  PostgreSQL Tables             │
├────────────────────────────────┤
│  • inventory ⭐                │
│    - product_code (PK)         │
│    - product_name              │
│    - purchase_price            │
│    - selling_price             │
│    - total_quantity            │
│    - min_quantity_alert        │
│    - is_low_stock (computed)   │
│                                │
│  • sales                       │
│  • sale_items                  │
│  • invoices (auto-created)     │
│  • invoice_items               │
│  • inventory_transactions      │
└────────────────────────────────┘
```

### 4. Triggers (PostgreSQL)

```
┌──────────────────────────────────┐
│  Auto-Invoice Generation         │
├──────────────────────────────────┤
│  AFTER INSERT ON sales           │
│    ↓                             │
│  create_invoice_from_sale() ⭐   │
│    ↓                             │
│  copy_sale_items_to_invoice() ⭐ │
└──────────────────────────────────┘
```

---

## 🎨 واجهة المستخدم

### جدول المخزون

```
┌───────────────────────────────────────────────────────────────┐
│ رمز المنتج │ اسم المنتج │ شراء │ بيع │ كمية │ حد │ حالة │ QR │ إجراءات │
├───────────────────────────────────────────────────────────────┤
│ PROD001    │ كاميرا     │ 35   │ 45  │ 50   │ 10 │ ✅  │ 🟢 │ 🟢 📝 🗑️ │
│ PROD002    │ جهاز       │ 120  │ 150 │  5   │ 10 │ ⚠️  │ 🟢 │ 🟢 📝 🗑️ │
└───────────────────────────────────────────────────────────────┘
                                                        ↑
                                                   انقر هنا
```

### Modal عرض QR

```
┌─────────────────────────────────┐
│  رمز QR للمنتج            [×]  │
├─────────────────────────────────┤
│                                 │
│     ┌─────────────────┐         │
│     │                 │         │
│     │   ████  ████    │         │
│     │   ██  ██  ██    │         │
│     │   ████  ████    │         │
│     │                 │         │
│     └─────────────────┘         │
│                                 │
│   المنتج: كاميرا أمنية         │
│   الرمز: PROD001                │
│                                 │
│  [💾 تحميل] [🖨️ طباعة] [❌ إغلاق]│
└─────────────────────────────────┘
```

---

## 📱 التوافق

```
✅ Desktop   (Chrome, Firefox, Edge, Safari)
✅ Tablet    (iPad, Android Tablets)
✅ Mobile    (iPhone, Android)
✅ RTL       (Right-to-Left Arabic)
✅ Offline   (بعد تحميل المكتبات)
```

---

## 🎯 الخلاصة التقنية

### ما يحدث عند النقر على زر QR:

```javascript
// 1. استقبال بيانات المنتج
viewQRCode({
  product_code: 'PROD001',
  product_name: 'كاميرا أمنية',
  selling_price: 45.500
})

// 2. عرض البيانات في Modal
document.getElementById('qrProductName').textContent = 'كاميرا أمنية'
document.getElementById('qrProductCode').textContent = 'PROD001'

// 3. إنشاء QR Code
QRCode.toCanvas(canvas, 'PROD001', {
  width: 300,
  margin: 2,
  color: { dark: '#1E293B', light: '#FFFFFF' }
})

// 4. عرض Modal
document.getElementById('qrModal').classList.add('active')
```

### ما يحدث عند التحميل:

```javascript
// 1. تحويل Canvas إلى Data URL
const url = canvas.toDataURL('image/png')

// 2. إنشاء رابط تحميل
const link = document.createElement('a')
link.download = 'QR_PROD001_كاميرا أمنية.png'
link.href = url

// 3. تفعيل التحميل
link.click()
```

---

## 🚀 الميزة الرئيسية

### قبل (الطريقة القديمة):
```
إضافة منتج → الذهاب لصفحة qr-generator.html 
→ توليد جماعي → تحميل → طباعة
```

### الآن (الطريقة الجديدة): ⭐
```
إضافة منتج → انقر زر QR 🟢 → تحميل/طباعة فوراً!
```

**توفير الوقت:** 80%  
**سهولة الاستخدام:** 100%  
**جاهز للاستخدام:** ✅ نعم

---

**تم بناؤه بواسطة:** GitHub Copilot  
**التاريخ:** 23 أكتوبر 2025  
**الإصدار:** 1.0.0  
**الحالة:** ✅ جاهز للإنتاج
