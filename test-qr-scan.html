<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø³Ø­ QR</title>
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1E293B;
            text-align: center;
            margin-bottom: 30px;
        }
        #reader {
            border: 2px solid #ddd;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        .result {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }
        .result.show {
            display: block;
        }
        .result.success {
            background: #d4edda;
            color: #155724;
        }
        .result.error {
            background: #f8d7da;
            color: #721c24;
        }
        .code {
            font-size: 20px;
            font-weight: bold;
            margin: 10px 0;
            font-family: monospace;
        }
        .history {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .history-item {
            padding: 10px;
            border-bottom: 1px solid #ddd;
            font-family: monospace;
        }
        .history-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø³Ø­ QR Code</h1>
        
        <div id="reader"></div>
        
        <div id="result" class="result">
            <strong>Ø§Ù„Ù†ØªÙŠØ¬Ø©:</strong>
            <div class="code" id="scannedCode"></div>
            <div id="timestamp"></div>
        </div>
        
        <div class="history">
            <strong>ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø³Ø­:</strong>
            <div id="historyList" style="margin-top: 10px;">
                <div style="color: #999; text-align: center; padding: 20px;">
                    Ù„Ù… ÙŠØªÙ… Ù…Ø³Ø­ Ø£ÙŠ Ø±Ù…ÙˆØ² Ø¨Ø¹Ø¯
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <script>
        let scanHistory = [];
        
        function onScanSuccess(decodedText, decodedResult) {
            console.log('âœ… Scan successful!');
            console.log('Decoded text:', decodedText);
            console.log('Full result:', decodedResult);
            
            // Show result
            const resultDiv = document.getElementById('result');
            resultDiv.className = 'result show success';
            document.getElementById('scannedCode').textContent = decodedText;
            document.getElementById('timestamp').textContent = new Date().toLocaleString('ar-EG');
            
            // Add to history
            scanHistory.unshift({
                code: decodedText,
                time: new Date().toLocaleString('ar-EG'),
                format: decodedResult.result.format.formatName
            });
            
            updateHistory();
            
            // Beep
            playBeep();
        }
        
        function onScanFailure(error) {
            // Silent - continuously scanning
        }
        
        function updateHistory() {
            const historyDiv = document.getElementById('historyList');
            
            if (scanHistory.length === 0) {
                historyDiv.innerHTML = '<div style="color: #999; text-align: center; padding: 20px;">Ù„Ù… ÙŠØªÙ… Ù…Ø³Ø­ Ø£ÙŠ Ø±Ù…ÙˆØ² Ø¨Ø¹Ø¯</div>';
                return;
            }
            
            historyDiv.innerHTML = scanHistory.map((item, index) => `
                <div class="history-item">
                    <strong>#${index + 1}</strong> ${item.code}<br>
                    <small>${item.format} - ${item.time}</small>
                </div>
            `).join('');
        }
        
        function playBeep() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 800;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.1);
        }
        
        // Initialize scanner
        const html5QrCode = new Html5Qrcode("reader");
        
        const config = {
            fps: 10,
            qrbox: { width: 250, height: 250 },
            aspectRatio: 1.0
        };
        
        html5QrCode.start(
            { facingMode: "environment" },
            config,
            onScanSuccess,
            onScanFailure
        ).catch(err => {
            console.error("Camera error:", err);
            const resultDiv = document.getElementById('result');
            resultDiv.className = 'result show error';
            document.getElementById('scannedCode').textContent = 'ØªØ¹Ø°Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§';
            document.getElementById('timestamp').textContent = err.message;
        });
        
        // Cleanup
        window.addEventListener('beforeunload', function() {
            if (html5QrCode && html5QrCode.isScanning) {
                html5QrCode.stop();
            }
        });
    </script>
</body>
</html>
